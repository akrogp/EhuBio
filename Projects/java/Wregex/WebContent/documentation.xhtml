<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:body>	
	<ui:composition template="./WEB-INF/templates/template.xhtml">
		<ui:define name="title">Documentation</ui:define>
		<ui:define name="htmlhead">
			<meta name="description" content="Wregex documentation. A novel approach for amino acid motif searching combining a regular expression with a Position-Specific Scoring Matrix (PSSM)."/>
		</ui:define>
		<ui:define name="content">
		<h:outputStylesheet name="css/documentation.css"/>
		<h:form id="docForm">
		
		<h3>Table of Contents</h3>
		<ul style="margin: 20px">
		<li><a href="#overview">Overview</a></li>
		<li><a href="#compat">Browser compatibility</a></li>
		<li><a href="#cases">Examples</a></li>		
		<li><a href="#search">Basic Search</a></li>		
		<li><a href="#custom">Search with a Custom Motif</a></li>
		<li><a href="#training">Building a Custom PSSM</a></li>
		<li><a href="#local">Running Wregex on your Local PC</a></li>
		</ul>		
		
		<h3 class=".ui-state-default"><a id="overview">Overview</a></h3>		
		<p>Wregex (weighted regular expression) searches for short linear motifs (SLiMs) candidates in
		a target amino acid protein sequences dataset by combining a regular expression with an
		optional Position-Specific Scoring Matrix (PSSM). The regular expression is used to obtain a
		list of SLiM candidates matching the desired conditions, while the PSSM is used for computing
		a score that allows to rank the matches and then select the most promising candidates.</p>
		<p>Wregex supports all motifs in <a href="http://elm.eu.org/">ELM</a> as regular expressions and
		also a number of custom motifs which include a PSSM. In case your motif of interest
		is not included in the dropdown list of predefined motifs or if a PSSM is not available for it,
		you can build your own custom motif following the steps detailed later on.
		In that case you can send us your motif definition and we will be happy to include it in the
		dropdown list of predefined motifs used in the basic search.</p>
		
		<h3><a id="compat">Browser compatibility</a></h3>
		<p:dataTable value="#{homeView.compat}" var="test" tableStyle="width:auto">
			<p:column headerText="OS">#{test.os}</p:column>
			<p:column headerText="Version">#{test.osVersion}</p:column>
			<p:columns value="#{homeView.browsers}" var="browser" headerText="#{browser}">
				#{test.browser.get(browser)}
			</p:columns>
		</p:dataTable>
		
		<h3><a id="cases">Examples</a></h3>		
		<p>To facilitate familiarity for novice users with the search form and the types of results obtained, the following presets are provided as example case studies:</p>		
		<p:dataTable id="casesTable" value="#{databasesBean.caseStudies}" var="case" rowIndexVar="idx" tableStyle="width:auto">
			<p:column headerText="Case">#{case.name}</p:column>
			<p:column headerText="Description">#{case.description}</p:column>
			<p:column headerText="Action">
				<p:commandButton action="#{homeView.navigateCase(case.value)}" value="Load Case Study ##{idx+1}" styleClass="caseButton"/>
			</p:column>
		</p:dataTable>
		
		<h3><a id="search">Basic Search</a></h3>
		<h:graphicImage name="tutorial/BasicSearch.png" style="float:right"/>		
		<p>The basic search consists on searching a target protein dataset for one or several predefined short linear motifs (SLiMs):</p>
		<ul>
			<li>First of all, the main motif of interest must be selected from the dropdown list. This list is divided into a first part
			containing entries specific of Wregex (for which both a regular expression and a PSSM are available), and a second part consisting
			on <a href="http://elm.eu.org/">ELM</a> entries (without a PSSM). Once a motif is selected, a second dropdown list is shown to the
			right allowing the user to select a specific motif configuration (different regular expression and/or PSSM) in case there are
			several available. Optionally, this process can be repeated for a second auxiliary motif.</li>
			<li>Next, a target protein dataset must be specified. This can be done in multiple ways: by selecting a predefined dataset available
			in the target dropdown list provided by Wregex, by providing a Gene Ontology (GO) term, by entering a list of
			protein accessions or gene names, or by uploading a custom fasta file.</li>
			<li>After completing the two steps above, a <i>Search!</i> button will be finally shown. Clicking
			this button starts a new search and a list of candidates will be shown when finished (if there is any match).</li>			
		</ul>
		<p>Additionally, external database <i>Connections</i> can be enabled for conducting more specific searches:</p>
		<ul>
			<li>COSMIC: for each candidate motif above searches COSMIC missense mutations and ranks the results according to each mutation
			impact and recurrence.</li>
			<li>PhosphoSitePlus/dbPTM: allows selecting the desired PTM types and for each candidate motif above searches the selected PTMs
			and ranks the results according to the number of PTMs present.</li>
		</ul>
		<p>The default Wregex behaviour can be customized by changing the <i>Options</i> section:</p>
		<ul>
			<li>The <i>Grouping</i> checkbox allows to configure whether overlapping candidates should be considered as
			a single entry or separated into multiple entries. An overlap occurs when there are several combinations
			that match the regular expression in the same region of the protein.</li>
			<li>The <i>Filter similar</i> checkbox is useful when the user is interested only in the motif sequence. If enabled,
			only the first result for the same matched sequence is shown.</li>
			<li>The <i>Filter without connections</i> checkbox keeps only the results with values for any of the external connections
			selected.</li>
			<li>The score <i>Threshold</i> spinner keeps only main motif matches with a PSSM score equal or larger than the value specified.</li>
			<li>The number of <i>Flanking</i> amino acids spinner shows additional amino acids at both sides of each match.</li>
		</ul>		
		<p>Finally, the results are displayed as follows:</p>
		<ul><h:graphicImage name="tutorial/Download.png" style="float:right"/>
			<li>First of all, the total number of results obtained is shown followed by three buttons that allow downloading
			these results into a local file in the user's computer in the following formats respectively:
				<ul>
					<li>Comma Separated Values (CSV): useful for further analysis using any spreadsheet or statistical analysis software.</li>
					<li>Clustal ALN file: can be used to display the alignments of the results using the capturing groups indicated between
					parenthesis () in the regular expression.</li>
					<li>Fasta: amino acid sequences that can also be used for training a PSSM as explained later on.</li>
				</ul>
			</li>
			<li>These results are also displayed on a table with the following columns (among others):
				<ul><h:graphicImage name="tutorial/Results.png" style="float:right"/>
					<li>Protein accession/entry from the fasta header.</li>
					<li>Starting and ending positions of the candidate motif within the protein sequence.</li>
					<li>Candidate motif sequence with the regular expression groups indicated between dashes (-).</li>
					<li>Number of combinations grouped in the same entry (overlapping positions).</li>
					<li>Wregex score (ranging from 0 to 100).</li>
					<li>If there are motif annotations with scores in the input fasta sequences, their score is also displayed as the assay score.</li>
					<li>Percentage of motif sequence within a disordered region annotated in UniProt.</li>
					<li>Number of features within the motif region annotated in UniProt. By passing the mouse over this number, detailed results are shown.</li>
					<li>If enabled, auxiliary motif score.</li>
					<li>If enabled, COSMIC mutated sequence, the mutation impact and the mutation recurrence.</li>
					<li>If enabled, PSP/dbPTM modifications within the candidate motif.</li>
				</ul>
			</li>
		</ul>
		
		<h3><a id="custom">Search with a Custom Motif</a></h3>
		<h:graphicImage name="tutorial/Custom.png" style="float:right"/>
		<p>When a pattern is not available for the motif of interest or when the user is interested in exploring
		a modification of an existing pattern, Wregex offers the possibility to define a custom pattern. To do so, in the
		Motif dropdown list select <i>Custom</i> and then an input text box will be shown to type (or paste and
		edit) the custom pattern. This amnino acid pattern must be defined using the syntax of the
		<a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_blank">
		Java Pattern class</a> for regular expressions. The <a href="https://jex.im/regulex" target="_blank">Regulex visualizer</a> may help
		novice users with defining custom regular expressions. For instance <tt>[LIMA].{2,3}[LIVMF]</tt> means any of
		leucine (L), isoleucine (I), methionine (M) or alanine (A) followed by 2 or 3 ({2,3}) occurrences of any (.)
		amino acid and then followed by any of leucine (L), isoleucine (I), valine (V), methionine (M) or phenylalanine (F).</p>
		<p>While not mandatory, Wregex exploits the use of regular expression <a href="https://docs.oracle.com/javase/tutorial/essential/regex/groups.html" target="_blank">
		capturing groups</a> for marking regions of the motif. For instance, in the pattern defined above consisting of two hydrophobic amino acids separated
		by a short variable-length region, each key hydrophobic amino acid position can be marked as a capturing group of a single amino acid, and the spacing
		region as a capturing group of 2 or 3 amino acids. This will be used by Wregex to align matches across the capturing groups and to define the
		Position-Specific Scoring Matrix (PSSM) positions as explained later on. Capturing groups are marked between parenthesis, so the updated regular
		expression using capturing groups would be <tt>([LIMA])(.{2,3})([LIVMF])</tt>. In the case that capturing groups have been defined and a PSSM
		file has previously been built, this PSSM file can optionally be used by clicking the <i>Select PSSM</i> button and thus
		scores will be reported for each of the matches.</p>
		<p>Finally, a target protein dataset can be selected as previously described and after clicking the <i>Search!</i> button the results
		obtained with this custom motif will be available.</p>

		<h3><a id="training">Building a Custom PSSM</a></h3>		
		<p>A motif pattern, defined as a regular expression alone, can be used to report matches to the target protein sequences, but it does
		not provide any kind of score to rank those matches and select the most promising ones. Wregex allows to optionally complement this regular expression		
		with a Position-Specific Scoring Matrix (PSSM) so that any match of the regular expression to the target protein sequences will also be assigned a score.
		Since motif matches usually have a variable amino acid length, Wregex exploits the use of regular expression <a href="http://docs.oracle.com/javase/tutorial/essential/regex/groups.html" target="_blank">
		capturing groups</a> to define the positions that will be used in the PSSM instead of inserting "gaps".
		Using the previous example, the following regular expression <tt>([LIMA])(.{2,3})([LIVMF])</tt>
		has three capturing groups (regions between parenthesis) so it will also define three PSSM positions: the first one consists of
		the first hydrophobic amino acid, the second one consists of the 2-3 amino acid separation, and the third one consists of the
		final hydrophobic amino acid. Then, a custom PSSM indicating a weight for every amino acid in each of the
		three positions can be provided for computing a match score.</p>
		<h:graphicImage name="tutorial/Training.png" style="float:right"/>		
		<p>A training web page is provided for allowing the user to build a custom PSSM. Basically this just requires
		the following steps:</p>
		<ol>
			<li>Enter into the input text box a regular expression with capturing groups to indicate the PSSM positions (see previous section).</li>
			<li>Provide an input fasta file with the training sequences by clicking the <i>Input motifs</i> button. An intermediate page will be shown
			as explained soon.</li>
			<li>A table with the <i>Training motifs</i> used to build the PSSM is shown at the end of the page. This table also offers the possibility of removing
			any of the motif matches that will be used for the training process just by clicking the recycle bin icon in the <i>Action</i> column.
			If this removed motif match overlapped with another match(es), the weight (column <i>Weight'</i>) of the remaining match(es) will be updated to account
			for the total weight (column <i>Weight</i>) considering the updated number of matches for that motif (column <i>"!"</i>).</li>
			<li>Download the PSSM by clicking any of the following buttons:
			<ul>
				<li>The <i>Download Coarse PSSM</i> button will not use decimals in the scores, thus rounding the results to
				coarse weights, which is suitable when the number of training sequences is not very large.</li>
				<li>The <i>Download Fine PSSM</i> button will use one decimal precision, thus providing more adjusted weights, which
				can be suitable if the number of training sequences is large enough. If in doubt, both PSSMs can be downloaded and tested
				against a validation dataset not used for training the PSSM.</li>
			</ul>
			</li>
			<li>This PSSM file can then be selected together with the custom regular expression to search for new motifs as previously explained
			in the <i>Search with a Custom Motif</i> section.</li>			
		</ol>		
		<h:graphicImage name="tutorial/InputMotifs2.png" style="float:right"/><h:graphicImage name="tutorial/InputMotifs1.png" style="float:right"/>
		<p>As previously stated, when the <i>Input motifs</i> button is clicked an intermediate page will be shown to specify the training motifs in the
		following manner:</p>
		<ul>
			<li>First of all, an input fasta file with the training sequences must be uploaded by clicking the <i>Select fasta</i> button.
			This fasta file does not have any special requirement, although internal annotations will be recognized if the file was generated
			previously from this training page. By clicking the following button you can download the example fasta file used for this documentation:  
			<h:form>
				<p:commandButton value="Download ASPs-score.fasta" action="#{tutorialView.downloadFasta('ASPs-score.fasta')}" ajax="false"/>
			</h:form>
			</li>
			<li>After selecting the fasta file, a table with the <i>Input motifs</i> will be displayed. From this table the user can optionally
			assign a weight to each of the matches, and even re-define the position of the match if it is a part of a larger motif.
			If this table is modified, the <i>Refresh</i> button must be pressed to show the updated results.
			Finally, the <i>Matched</i> column displays the number of matches of the custom regex within the motif position range defined.
			This number will be used to divide the motif weight between the different matches when building the PSSM.</li>
			<li>The resulting training motif list can optionally be downloaded as a fasta file by clicking the <i>Download motifs</i> button.
			This file will have internal annotations of the motif positions and weights so that they can be recovered in the future if it is uploaded by clicking the
			<i>Select fasta</i> button for refining or continuing the training process.</li>
			<li>Once the input motif list has been defined, clicking the <i>Continue with PSSM training</i> button will redirect to the previous training
			page to download the PSSM file as previously explained.</li>
		</ul>
		<p>If you define a custom motif (custom regex and/or custom PSSM) that can be of interest to others, please contact us
		and we will be happy to include it in the Wregex dropdown list of motifs to facilitate its use through the basic search form.</p>
		
		<h3><a id="local">Running Wregex on your Local PC</a></h3>
		<p>Wregex execution at #{homeView.webUrl} has some constraints in order to avoid denial of service to other users, i.e.
		input target protein dataset limit and execution time limit. These constraints can be avoided by running Wregex
		locally on your computer and changing the default limits.</p>
		<p>To run Wregex on your local computer, you need a Java EE 8 (or later) application server. Then you can download the <tt>*.war</tt>
		binary distributable and copy it into your deployments directory. Both the binary file and the Java code can be accessed from the
		Downloads page.</p>
		<p>You can change the default execution limits by editing the <tt>WEB-INF/web.xml</tt> file. Please take into account that Wregex uses
		a predefined set of databases which must be present in your system. You can modify (add/delete) these databases
		by editing the <tt>resources/data/databases.xml</tt> file. If you need help with this process please contact us and we will be happy to
		assist you.</p>

		<p:blockUI block="docForm" trigger="@(.caseButton)">
			Loading...
		</p:blockUI>
		</h:form>		
		</ui:define>
	</ui:composition>
</h:body>
</html>
